'use strict';(function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){function w(a,c){function b(a){if(!d.parentNode)return e.off(document,"mousemove",b);d.style.top=Math.max(0,a.clientY-d.offsetHeight-5)+"px";d.style.left=a.clientX+5+"px"}var d=document.createElement("div");d.className="CodeMirror-lint-tooltip";d.appendChild(c.cloneNode(!0));document.body.appendChild(d);
e.on(document,"mousemove",b);b(a);null!=d.style.opacity&&(d.style.opacity=1);return d}function x(a){a.parentNode&&(null==a.style.opacity&&a.parentNode&&a.parentNode.removeChild(a),a.style.opacity=0,setTimeout(function(){a.parentNode&&a.parentNode.removeChild(a)},600))}function q(a,c,b){function d(){e.off(b,"mouseout",d);f&&(x(f),f=null)}var f=w(a,c),g=setInterval(function(){if(f)for(var a=b;;a=a.parentNode){a&&11==a.nodeType&&(a=a.host);if(a==document.body)return;if(!a){d();break}}if(!f)return clearInterval(g)},
400);e.on(b,"mouseout",d)}function y(a,c,b){this.marked=[];this.options=c;this.timeout=null;this.hasGutter=b;this.onMouseOver=function(c){var b=c.target||c.srcElement;if(/\bCodeMirror-lint-mark-/.test(b.className)){for(var b=b.getBoundingClientRect(),g=a.findMarksAt(a.coordsChar({left:(b.left+b.right)/2,top:(b.top+b.bottom)/2},"client")),b=[],k=0;k<g.length;++k)b.push(g[k].__annotation);if(b.length){for(var g=c.target||c.srcElement,k=document.createDocumentFragment(),e=0;e<b.length;e++)k.appendChild(r(b[e]));
q(c,k,g)}}};this.waitingFor=0}function t(a){var c=a.state.lint;c.hasGutter&&a.clearGutter("CodeMirror-lint-markers");for(a=0;a<c.marked.length;++a)c.marked[a].clear();c.marked.length=0}function z(a,c,b,d){var f=document.createElement("div"),g=f;f.className="CodeMirror-lint-marker-"+c;b&&(g=f.appendChild(document.createElement("div")),g.className="CodeMirror-lint-marker-multiple");if(0!=d)e.on(g,"mouseover",function(b){q(b,a,g)});return f}function r(a){var c=a.severity;c||(c="error");var b=document.createElement("div");
b.className="CodeMirror-lint-message-"+c;b.appendChild(document.createTextNode(a.message));return b}function A(a,c,b){function d(){g=-1;a.off("change",d)}var f=a.state.lint,g=++f.waitingFor;a.on("change",d);c(a.getValue(),function(b,c){a.off("change",d);f.waitingFor==g&&(c&&b instanceof e&&(b=c),u(a,b))},b,a)}function m(a){var c=a.state.lint.options,b=c.options||c,d=c.getAnnotations||a.getHelper(e.Pos(0,0),"lint");d&&(c.async||d.async?A(a,d,b):u(a,d(a.getValue(),b,a)))}function u(a,c){t(a);for(var b=
a.state.lint,d=b.options,f=[],g=0;g<c.length;++g){var e=c[g],l=e.from.line;(f[l]||(f[l]=[])).push(e)}for(g=0;g<f.length;++g)if(e=f[g]){for(var l=null,m=b.hasGutter&&document.createDocumentFragment(),p=0;p<e.length;++p){var h=e[p],n=h.severity;n||(n="error");"error"!=l&&(l=n);d.formatAnnotation&&(h=d.formatAnnotation(h));b.hasGutter&&m.appendChild(r(h));h.to&&b.marked.push(a.markText(h.from,h.to,{className:"CodeMirror-lint-mark-"+n,__annotation:h}))}b.hasGutter&&a.setGutterMarker(g,"CodeMirror-lint-markers",
z(m,l,1<e.length,b.options.tooltips))}if(d.onUpdateLinting)d.onUpdateLinting(c,f,a)}function v(a){var c=a.state.lint;c&&(clearTimeout(c.timeout),c.timeout=setTimeout(function(){m(a)},c.options.delay||500))}e.defineOption("lint",!1,function(a,c,b){b&&b!=e.Init&&(t(a),!1!==a.state.lint.options.lintOnChange&&a.off("change",v),e.off(a.getWrapperElement(),"mouseover",a.state.lint.onMouseOver),clearTimeout(a.state.lint.timeout),delete a.state.lint);if(c){var d=a.getOption("gutters");b=!1;for(var f=0;f<
d.length;++f)"CodeMirror-lint-markers"==d[f]&&(b=!0);d=a.state;c instanceof Function?c={getAnnotations:c}:c&&!0!==c||(c={});b=d.lint=new y(a,c,b);if(!1!==b.options.lintOnChange)a.on("change",v);if(0!=b.options.tooltips)e.on(a.getWrapperElement(),"mouseover",b.onMouseOver);m(a)}});e.defineExtension("performLint",function(){this.state.lint&&m(this)})});
