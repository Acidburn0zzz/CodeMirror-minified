'use strict';(function(g){"object"==typeof exports&&"object"==typeof module?g(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],g):g(CodeMirror)})(function(g){function q(b,a,c,f){this.atOccurrence=!1;this.doc=b;null==f&&"string"==typeof a&&(f=!1);c=c?b.clipPos(c):k(0,0);this.pos={from:c,to:c};if("string"!=typeof a)a.global||(a=new RegExp(a.source,a.ignoreCase?"ig":"g")),this.matches=function(m,h){if(m){a.lastIndex=0;m=b.getLine(h.line).slice(0,
h.ch);for(var e=0,d,c;;){a.lastIndex=e;e=a.exec(m);if(!e)break;d=e;c=d.index;e=d.index+(d[0].length||1);if(e==m.length)break}(e=d&&d[0].length||0)||(0==c&&0==m.length?d=void 0:c!=b.getLine(h.line).length&&e++)}else a.lastIndex=h.ch,m=b.getLine(h.line),e=(d=a.exec(m))&&d[0].length||0,c=d&&d.index,c+e==m.length||e||(e=1);if(d&&e)return{from:k(h.line,c),to:k(h.line,c+e),match:d}};else{var g=a;f&&(a=a.toLowerCase());var n=f?function(b){return b.toLowerCase()}:function(b){return b},l=a.split("\n");if(1==
l.length)this.matches=a.length?function(c,h){if(c){c=b.getLine(h.line).slice(0,h.ch);var e=n(c),d=e.lastIndexOf(a);if(-1<d)return d=r(c,e,d),{from:k(h.line,d),to:k(h.line,d+g.length)}}else if(c=b.getLine(h.line).slice(h.ch),e=n(c),d=e.indexOf(a),-1<d)return d=r(c,e,d)+h.ch,{from:k(h.line,d),to:k(h.line,d+g.length)}}:function(){};else{var p=g.split("\n");this.matches=function(c,a){var e=l.length-1;if(c){if(!(a.line-(l.length-1)<b.firstLine())&&n(b.getLine(a.line).slice(0,p[e].length))==l[l.length-
1]){c=k(a.line,p[e].length);a=a.line-1;for(var d=e-1;1<=d;--d,--a)if(l[d]!=n(b.getLine(a)))return;var d=b.getLine(a),f=d.length-p[0].length;if(n(d.slice(f))==l[0])return{from:k(a,f),to:c}}}else if(!(a.line+(l.length-1)>b.lastLine())&&(d=b.getLine(a.line),f=d.length-p[0].length,n(d.slice(f))==l[0])){c=k(a.line,f);a=a.line+1;for(d=1;d<e;++d,++a)if(l[d]!=n(b.getLine(a)))return;if(n(b.getLine(a).slice(0,p[e].length))==l[e])return{from:c,to:k(a,p[e].length)}}}}}}function r(b,a,c){if(b.length==a.length)return c;
for(a=Math.min(c,b.length);;){var f=b.slice(0,a).toLowerCase().length;if(f<c)++a;else if(f>c)--a;else return a}}var k=g.Pos;q.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(b){function a(a){a=k(a,0);c.pos={from:a,to:a};return c.atOccurrence=!1}for(var c=this,f=this.doc.clipPos(b?this.pos.from:this.pos.to);;){if(this.pos=this.matches(b,f))return this.atOccurrence=!0,this.pos.match||!0;if(b){if(!f.line)return a(0);f=k(f.line-1,this.doc.getLine(f.line-
1).length)}else{var g=this.doc.lineCount();if(f.line==g-1)return a(g);f=k(f.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(b,a){this.atOccurrence&&(b=g.splitLines(b),this.doc.replaceRange(b,this.pos.from,this.pos.to,a),this.pos.to=k(this.pos.from.line+b.length-1,b[b.length-1].length+(1==b.length?this.pos.from.ch:0)))}};g.defineExtension("getSearchCursor",function(b,a,c){return new q(this.doc,b,a,c)});
g.defineDocExtension("getSearchCursor",function(b,a,c){return new q(this,b,a,c)});g.defineExtension("selectMatches",function(b,a){var c=[];for(b=this.getSearchCursor(b,this.getCursor("from"),a);b.findNext()&&!(0<g.cmpPos(b.to(),this.getCursor("to")));)c.push({anchor:b.from(),head:b.to()});c.length&&this.setSelections(c,0)})});
