'use strict';(function(h){"object"==typeof exports&&"object"==typeof module?h(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],h):h(CodeMirror)})(function(h){function w(b){b=b.search(q);return-1==b?0:b}function D(b,d,a){return/\bstring\b/.test(b.getTokenTypeAt(l(d.line,0)))&&!/^[\'\"`]/.test(a)}var z={},q=/[^\s\u00a0]/,l=h.Pos;h.commands.toggleComment=function(b){b.toggleComment()};h.defineExtension("toggleComment",function(b){b||(b=z);for(var d=
Infinity,a=this.listSelections(),c=null,e=a.length-1;0<=e;e--){var f=a[e].from(),g=a[e].to();f.line>=d||(g.line>=d&&(g=l(d,0)),d=f.line,null==c?this.uncomment(f,g,b)?c="un":(this.lineComment(f,g,b),c="line"):"un"==c?this.uncomment(f,g,b):this.lineComment(f,g,b))}});h.defineExtension("lineComment",function(b,d,a){a||(a=z);var c=this,e=c.getModeAt(b),f=c.getLine(b.line);if(null!=f&&!D(c,b,f)){var g=a.lineComment||e.lineComment;if(g){var m=Math.min(0!=d.ch||d.line==b.line?d.line+1:d.line,c.lastLine()+
1),h=null==a.padding?" ":a.padding,k=a.commentBlankLines||b.line==d.line;c.operation(function(){if(a.indent){for(var d=null,f=b.line;f<m;++f){var e=c.getLine(f),e=e.slice(0,w(e));if(null==d||d.length>e.length)d=e}for(f=b.line;f<m;++f){var e=c.getLine(f),p=d.length;if(k||q.test(e))e.slice(0,p)!=d&&(p=w(e)),c.replaceRange(d+g+h,l(f,0),l(f,p))}}else for(f=b.line;f<m;++f)(k||q.test(c.getLine(f)))&&c.replaceRange(g+h,l(f,0))})}else if(a.blockCommentStart||e.blockCommentStart)a.fullLines=!0,c.blockComment(b,
d,a)}});h.defineExtension("blockComment",function(b,d,a){a||(a=z);var c=this,e=c.getModeAt(b),f=a.blockCommentStart||e.blockCommentStart,g=a.blockCommentEnd||e.blockCommentEnd;if(f&&g){var m=Math.min(d.line,c.lastLine());m!=b.line&&0==d.ch&&q.test(c.getLine(m))&&--m;var h=null==a.padding?" ":a.padding;b.line>m||c.operation(function(){if(0!=a.fullLines){var k=q.test(c.getLine(m));c.replaceRange(h+g,l(m));c.replaceRange(f+h,l(b.line,0));var x=a.blockCommentLead||e.blockCommentLead;if(null!=x)for(var n=
b.line+1;n<=m;++n)(n!=m||k)&&c.replaceRange(x+h,l(n,0))}else c.replaceRange(g,d),c.replaceRange(f,b)})}else(a.lineComment||e.lineComment)&&0!=a.fullLines&&c.lineComment(b,d,a)});h.defineExtension("uncomment",function(b,d,a){a||(a=z);var c=this,e=c.getModeAt(b),f=Math.min(0!=d.ch||d.line==b.line?d.line:d.line-1,c.lastLine()),g=Math.min(b.line,f),h=a.lineComment||e.lineComment,w=[],k=null==a.padding?" ":a.padding,x;a:if(h){for(var n=g;n<=f;++n){var A=c.getLine(n),p=A.indexOf(h);-1<p&&!/comment/.test(c.getTokenTypeAt(l(n,
p+1)))&&(p=-1);if(-1==p&&(n!=f||n==g)&&q.test(A))break a;if(-1<p&&q.test(A.slice(0,p)))break a;w.push(A)}c.operation(function(){for(var a=g;a<=f;++a){var b=w[a-g],d=b.indexOf(h),e=d+h.length;0>d||(b.slice(e,e+k.length)==k&&(e+=k.length),x=!0,c.replaceRange("",l(a,d),l(a,e)))}});if(x)return!0}var u=a.blockCommentStart||e.blockCommentStart,t=a.blockCommentEnd||e.blockCommentEnd;if(!u||!t)return!1;var C=a.blockCommentLead||e.blockCommentLead,y=c.getLine(g),v=f==g?y:c.getLine(f),B=y.indexOf(u),r=v.lastIndexOf(t);
-1==r&&g!=f&&(v=c.getLine(--f),r=v.lastIndexOf(t));if(-1==B||-1==r||!/comment/.test(c.getTokenTypeAt(l(g,B+1)))||!/comment/.test(c.getTokenTypeAt(l(f,r+1))))return!1;e=y.lastIndexOf(u,b.ch);a=-1==e?-1:y.slice(0,b.ch).indexOf(t,e+u.length);if(-1!=e&&-1!=a&&a+t.length!=b.ch)return!1;a=v.indexOf(t,d.ch);b=v.slice(d.ch).lastIndexOf(u,a-d.ch);e=-1==a||-1==b?-1:d.ch+b;if(-1!=a&&-1!=e&&e!=d.ch)return!1;c.operation(function(){c.replaceRange("",l(f,r-(k&&v.slice(r-k.length,r)==k?k.length:0)),l(f,r+t.length));
var a=B+u.length;k&&y.slice(a,a+k.length)==k&&(a+=k.length);c.replaceRange("",l(g,B),l(g,a));if(C)for(a=g+1;a<=f;++a){var b=c.getLine(a),d=b.indexOf(C);if(-1!=d&&!q.test(b.slice(0,d))){var e=d+C.length;k&&b.slice(e,e+k.length)==k&&(e+=k.length);c.replaceRange("",l(a,d),l(a,e))}}});return!0})});
